{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<div style="width: 80%; padding: 20px;">
{% for content in contents %}     
<div style="width: 80%; padding: 20px;"> 

</div>
{% endfor %}
<div id="root"></div>
<script type="text/babel">
    
    function App() {
        const { useState, useEffect } = React;
        const [post, setPost] = useState([]);
        const [postlikes, setPostLikes] = useState([]);
        const [postComments, setPostComments] = useState([]);

        useEffect(() => {
            axios.get("postlist").then((data) => {                
                setPost(data?.data);
            });
            getData("postlikes");
            getData("postcomments");
        }, []);
        function search(k, arr) {
            return arr[k] || 0
        };
        async function getData(pg) {
           await axios.get(pg).then((data) => {
               var arr = {};
               let v = data.data.split(';')
               for (var i = 0; i < v.length; i++) {
                    var s = v[i].split(':');
                    if(s[0] === null || s[0] === '' || s[0] === 'null' || typeof s[0] === 'undefined') {
                        break;
                    }
                    arr[s[0].trim()] = s[1].trim();
                }
                if(pg === "postlikes") {
                   setPostLikes(arr);                    
                }
                else if(pg === "postcomments") {
                    setPostComments(arr); 
                }
                
            })
        };
        const userStylePic = {
            backgroundColor: "#AED6F1",
            width: "50px",
            height: "50px",
            float: "left",
            textAlign: "center",
            borderRadius: "50%",
            fontSize: "32px",
            paddingLeft: "10px",
        };
        const userStylePic2 = {
            backgroundColor: "#AED6F1",
            width: "20px",
            height: "20px",
            float: "left",
            borderRadius: "50%",
            fontSize: "12px",            
            paddingLeft: "10px",
            display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        };
        const divstyle = {
            height: "120px"
        };
        const divcontstyle = {
            height: "100px",
            marginRight: "10%"
        };
        const styleUserProfile = {
            textAlign: "left",
        };
        const optionsStyle = {
            paddingLeft: "10px",
        };
        const lineStyle = {
            width: "100%",
            color: "gray"
        }
        const divcommentStyle = {
            width: "80%",  
            border: "1px solid gray",
            borderRadius: "6px",
            textAlign: "left",
            fontSize: "12px",
            fontWeight: "500",
            lineHeight: "20px",
            listStyle: "none",
            padding: "2px 4px",
            display: "inline-block"
        };
        const commentStyle = {
          border: "0px",          
        };
        const commenticons = {
          textAlign: "right",
          float: "right",
        };
        const centerText = {
            textAlign: "center",            
        }
        const timeOfPost = {
            fontSize: "10px"
        };
        const likesStyle = {
            backgroundColor: "#3498DB",
            borderRadius: "50%",
            color: "white",
            textAlign: "center"
        };
        const div_content_style = {
            backgroundColor: "white",
            borderRadius: "26px",  
            margin: "10px",          
        };
        const table_of_content_style = {
            margin: "16px",
        };
        const commentMargin = {
            marginLeft: "16px",
        };
        return (
                <div>  
                    { post.map(p => ( 
                        <div key={ p.pk } style={ div_content_style }>
                            <table style={ table_of_content_style }>
                                <tbody>
                                    <tr>
                                        <td>
                                            <label style={ userStylePic }><span style={ centerText }>{ p.fields.topic }</span></label>
                                            <a href={ 'content/' + p.fields.link } style={ styleUserProfile }>
                                                { p.fields.title }
                                            </a> <br />
                                            <span style={ timeOfPost }>0 days</span>
                                        </td>    
                                    </tr>
                                    <tr>
                                        <td>
                                            { p.fields.post_content.slice(0, 200) + "..." } <br />
                                            <span style={ likesStyle }>
                                                <i className="bi bi-hand-thumbs-up"></i>
                                            </span> { search(p.pk, postlikes) }
                                            <span style={ commentMargin }>
                                                <i className="bi bi-chat-left"></i>
                                            </span> { search(p.pk, postComments) }                    
                                        </td>                                   
                                    </tr> 
                                    <tr>
                                        <td><hr style={ lineStyle } /></td>
                                    </tr>      
                                    <tr>
                                        <td>
                                            <i className="bi bi-hand-thumbs-up"></i> Like   
                                            <i className="bi bi-chat-left" style={ optionsStyle }></i> comment    
                                            <i className="bi bi-share" style={ optionsStyle }></i> share
                                        </td>
                                    </tr>  
                                    <tr>
                                        <td><hr style={ lineStyle } /></td>
                                    </tr>   
                                    <tr>
                                        <td>
                                            <label style={ userStylePic2 } className="centerText"><span>{ p.fields.topic }</span></label>
                                            <div style={ divcommentStyle } >
                                                <input type="text" style={ commentStyle }
                                                    placeholder="Write a comment..." />
                                                    <span style={ commenticons }>
                                                        <i className="bi bi-emoji-smile" style={ optionsStyle }></i>
                                                        <i className="bi bi-image" style={ optionsStyle }></i>
                                                        <i className="bi bi-hand-thumbs-up" style={ optionsStyle }></i>
                                                        <i className="bi bi-hand-thumbs-down" style={ optionsStyle }></i>
                                                        <i className="bi bi-heart" style={ optionsStyle }></i>
                                                        <i className="bi bi-handbag" style={ optionsStyle }></i>
                                                    </span>
                                            </div>    
                                        </td>    
                                    </tr>    
                                </tbody>    
                            </table>    
                            <br /><br />                   
                        </div> 
                    )) }                            
                </div>
        );  
    }
    const html_root = document.getElementById('root');
    ReactDOM.createRoot(html_root).render(<App />);
</script>
</div>
{% endblock content %}